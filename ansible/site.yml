# configure Nexus via rest api
#
# cd ansible
# ansible-playbook site.yml --extra-vars "api_base_uri=https://nexus.thehypepipe.co.uk"
#
# set env vars
# export NEW_ADMIN_PASSWORD=<NEW_ADMIN_PASSWORD>
# export AUTOGENERATED_ADMIN_PASSWORD=<MY_AUTOGENERATED_ADMIN_PASSWORD>
---
- name: configure nexus
  hosts: localhost
  connection: local
  gather_facts: no
  # debugger: always

  # DEFAULTS
  # reduce calling the same module repeatedly with the same arguments
  # https://docs.ansible.com/ansible/latest/user_guide/playbooks_module_defaults.html
  module_defaults:
    uri:
      # automatically formats body as json, and sets the Content-Type header
      body_format: json
      user: "{{ api_user }}"
      password: "{{ admin_password }}"
      force_basic_auth: yes
      timeout: 10

  tasks:
  # ROLES
  - import_role:
      name: init
  - import_role:
      name: user
  - import_role:
      name: nuget_repo
  - import_role:
      name: docker_repo
  - import_role:
      name: helm_repo
  - import_role:
      name: pypi_repo
